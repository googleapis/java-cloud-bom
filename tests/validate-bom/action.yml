name: 'Maven BOM Validation'
description: 'Validation for the content of a Maven BOM'
inputs:
  bom-path:
    description: "The relative path from the repository root to the pom.xml file"
    required: true
runs:
  using: "composite"
  steps:
  - name: Set up Maven
    uses: stCarolas/setup-maven@v4.5
    with:
      maven-version: 3.8.4
  - name: Create temporary directory /tmp/bom-validation
    shell: bash
    run: mkdir -p /tmp/bom-validation
  - name: Create a canary project that uses the BOM
    shell: bash
    run: |
      echo "pwd: $(pwd)"
      if [ ! -r "${{ inputs.bom-path }}" ]; then
        echo "The input bom-path ${{ inputs.bom-path }} is not readable"
        exit 1
      fi
      
      bom_absolute_path=$(realpath "${{ inputs.bom-path }}")
      cd ${{ github.action_path }}
      echo "Running Maven in $(pwd)"
      mvn -V -ntp compile
      mvn -V -ntp -B exec:java -DoutputPath=/tmp/bom-check -DbomPath="${bom_absolute_path}"
  - name: Build the canary project that uses the BOM
    shell: bash
    working-directory: /tmp/bom-validation
    run: mvn -ntp -B install

